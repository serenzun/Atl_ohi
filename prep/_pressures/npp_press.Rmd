---
title: "OHI-atl/prs_fish/npp"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(raster)
library(ncdf4)
library(maps)
library(parallel)
library(foreach)
library(doParallel)
library(RColorBrewer)

```

#Summary
(from ohiprep_v2020 and previous) This script calculates log-transformed, mean annual net primary production values globally from 2003 to 2015. This data is used to standardize commercial fishing catch to produce [fishing pressure layers for OHI]

#Data source
GLOBAL-REANALYSIS-BIO-001-029-MONTHLY

**Reference**:CMEMS copernicus https://resources.marine.copernicus.eu/?option=com_csw&task=results **Downloaded**: August 12, 2020 Description: Monthly Net Primary Production (mg C / m2 / day): we used Total Primary Production of Phyto
nppv (mg m-3 day-1) 
**Native data** resolution: 0.25 degree x 0.25 degree (75 depth levels) 
**Time range**: From 1993-01-01 to 2019-12-23. both daily and montly mean. 
**Format**: NetCfd fo rmat Variables: CHL PHYC O2 NO3 PO4 SI FE SPCO2 PH PP. Here we used PP. **Geographical area selected**: -99, 85, 70, -80

IL FILE Ã¨ TROPPO GRANDE. DEVO FORSE SCARICARLI IN CARTELLE ANNO PER ANNO PER POTERCI FARE LA MEDIA PER CIASCUN ANNO? Instructions

Parameters used for downloading the data

Parameter	Value|Product	MEDSEA_ANALYSIS_FORECAST_BIO_006_014
---------------|--------------------------------------------
Frequency|	monthly
Lat min|	30.18
Lat max|	45.97
Lon min|	-5.54
Lon max|	36.29
Timesteps|	2019-09-01, 2019-09-09
Service for downloading|	
Files total dimension|	~250 MB
Datasets| 
* med-ogs-pft-an-fc-m
* med-ogs-nut-an-fc-m
* med-ogs-co2-an-fc-m

```{r}
# set bigdir directory for raster analysis

setwd("C:/Users/Acer/Documents/big")

bigdir='~/big/R_raster_tmp' 

dir.create(bigdir, showWarnings=T)

#define paths for the raw data and layer folder held on my pc Documents folder. (Once the project starts, the path should migrate to a shared database)
raw <- stack(file.path(bigdir, 'global-reanalysis-bio-001-029-monthly_1597267552177.nc'))
plot(raw[[1]]) 
```
```{r}
atl_npp <- raster::crop(reg_atl_FAO_sp,raw)
atl_nppe <- raster::crop(raw,reg_atl_FAO_sp)

plot(atl_npp, axes = FALSE)
plot(atl_npp, add = TRUE, box = FALSE, axes = FALSE)

nc<-ncdf4::nc_open(file.choose(raw))
print(nc)

```
```{r}
plot(atl_npp, add = TRUE, box = FALSE, axes = FALSE)
```





#Raster calculation
You can perform operations on a RasterStack by using the calc() function from the raster package. calc() lets you define a function to apply across all layers in the stack.
