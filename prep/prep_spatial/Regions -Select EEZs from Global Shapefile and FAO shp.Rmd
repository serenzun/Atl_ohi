<<<<<<< HEAD
---
title: "Regions -Select EEZs from Global Shapefile and FAO shp"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

library(sf)
library(raster)       #Main raster library with nearly all functions used in this analysis
library(rgdal)        #Spatial library - most functions used from rgdal are for vectors (shapefiles)
library(dplyr)        #NOT spatial - this is a data wrangling library

#devtools::install_github("ecohealthalliance/fasterize")  #to install fasterize you need to run this line
library(fasterize)
#devtools::install_github("tidyverse/ggplot2")
library(ggplot2)
library(dplyr)
library(rgdal)
library(raster)
library(here)
library(ggridges)
library(ggplot2)
library(tidyverse)
library(ncdf4)

```


#Read in global shapefile

You will have to point the path to where the global OHI EEZ file is located on your local computer.

```{r}
#use readOGR to read in the global shapefile. 
## dsn: path name, layer: name of the shapefile
#!!!eezs = readOGR(dsn = 'shapefiles', layer = 'linee_fao'))

```
#use st_read to read in the global regions shapefile as a simple feature object -->https://ohi-science.org/news/cropping-rasters-down-to-size 
This comes from the sf package and is a preferred method of loading and working with spatial data as opposed to using readOGR() from the rgdal package. The st_read() function will read in the shapefile as a simple feature object, meaning the spatial information is stored in a dataframe. This allows you to use data wrangling tools such as dplyr to work with the data.
```{r}
here()

setwd("C:/Users/Acer/Documents/big")
regions_gl <- st_read("~/big/FAO_areasMAJOR/FAO_AREAS.shp", quiet = TRUE)


head(regions_gl)
```
```{r}
plot(regions_gl[4]) #plot() which column to show, otherwise R will create a plot for every column, which we do not need
```
```{r}
# filter the regions you want:
regions_atl_FAO<- regions_gl %>% 
  dplyr::filter(OCEAN == "Atlantic") %>% 
  filter(F_LEVEL=="MAJOR") %>% 
  select(-13,-14) 
  
#reduce to F_CODE

plot(regions_atl_FAO[4], key.pos=1)
```
```{r}
# save the output (saving as an ESRI Shapefile):
#Save shapefile

#Use rgdal::writeOGR() to save the shapefile. 

#writeOGR(myShape,dsn='globalprep/spatial',layer='bhi_global_eezs', driver = "ESRI Shapefile") #Set the driver equal to ESRI Shapefile.

dir_BIG <-  "C:/Users/Documents/big/shapefile"
#writeOGR(regions_atl_FAO,dsn=path.expand(dir_BIG),layer='regions_atl_FAO', driver = 'ESRI #Shapefile',overwrite_layer=TRUE )
#
#writeOGR(regions_atl_FAO, dsn = path.expand(dir_intermediate), layer = 'bhi_transf', driver = #'ESRI Shapefile', overwrite = TRUE) 
#


setwd("C:/Users/Acer/Documents/big")

bigdir='~/big/R_raster_tmp' 

dir.create(bigdir, showWarnings=T)
sf::write_sf(regions_atl_FAO,paste0(bigdir),"/",  "Regions_atl_FAO.shp", driver = "ESRI Shapefile")#if you want to re-run, delete the file in the folder
```

I don't understand how to save the shp in the folder outside the git.!!


```{r}
#writeOGR(dsn='C:/Users/Acer/Documents/big/shapefile',regions_atl_FAO,"Regions_atl_FAO.shp", driver #= "ESRI Shapefile")#if riteOGR(myShape,dsn='globalprep/spatial',layer='bhi_global_eezs', driver = #"ESRI Shapefile") 
#st_drivers()
```

we need to convert the regions object to a SpatialPolygonsDataFrame. This is done using as(). You pass your simple feature object - regions - to as() and tell it to convert to a Spatial object. This returns the same polygons but as a SpatialPolygonsDataFrame.
```{r}
library(rgdal)
reg_atl_FAO_sp <- as(regions_atl_FAO, 'Spatial') #to avoid the error 'invalid multibyte string' delete the special chr (french and spanish name)
reg_atl_FAO_sp
plot(reg_atl_FAO_sp)
```

Upload the raster file--> big file are saved in the big2 folder on my pc
## You will need to replace this file path with where the file is located on your own computer.


global-reanalysis-bio-001-033-weekly_1597055060020
mangrove <- raster('/home/afflerbach/big/mangrove_2012_mw_km2.tif')

##setting plot margins
par(mar = c(0.1, 0.1, 0.1, 0.3))
plot(mangrove, col = "black", axes = FALSE)


scaricare file da copernicus:
prodotti: GLOBAL_REANALYSIS_BIO_001_033

leggere shapefile:

readOGR()
```{r}
here()
source(here::here('Documents'))
shp_atl <- file.path("FAO_atl_MAJOR.shp")


```

